var tron={};
tron.Direction={UP:"up",LEFT:"left",RIGHT:"right",DOWN:"down"};
tron.xy=function(a,b){this.x=a;this.y=b};
tron.Player=function(b,e,c,a,d)
{this.computer=d;
  this.area_array=new Array();
  this.positionX=c;
  this.positionY=a;
  this.pName=b;
  this.pColor=e;
  this.alive=true;
  this.direction=tron.Direction.RIGHT;
  this.isAlive=function(){return this.alive};
  this.kill=function(){this.alive=false;this.area_array=new Array()};
  this.left=function(){if(this.direction===tron.Direction.RIGHT){return}this.direction=tron.Direction.LEFT};this.right=function(){if(this.direction===tron.Direction.LEFT){return}this.direction=tron.Direction.RIGHT};this.up=function(){if(this.direction===tron.Direction.DOWN){return}this.direction=tron.Direction.UP};this.down=function(){if(this.direction===tron.Direction.UP){return}this.direction=tron.Direction.DOWN};this.move=function(){if(!this.alive){return}this.area_array.push(new tron.xy(this.positionX,this.positionY));if(this.direction==tron.Direction.LEFT){this.positionX--}else{if(this.direction==tron.Direction.RIGHT){this.positionX++}else{if(this.direction==tron.Direction.UP){this.positionY--}else{if(this.direction==tron.Direction.DOWN){this.positionY++}}}}}};function getNumberOfPlayers(){return $("#player").val()}function isPixelLook(){return(($("#pixel:checked").val())?true:false)}tron.Game=function(){var b=$("#canvas")[0].getContext("2d");var o=$("#canvas").width();var g=$("#canvas").height();var d=5;this.player_array=new Array();c();this.getHeight=function(){return g};function i(s,h,t){b.fillText(s,h,t)}this.displayGameOver=function(){b.fillText(gameOver,5,g-5)};function f(){var y=getNumberOfPlayers();player_array=[];for(var v=0;v<y;v++){var t=Math.round(Math.random()*(o-d)/d);var s=Math.round(Math.random()*(g-d)/d);var w=u(v/y,0.95,0.5);var z=x(w[0],w[1],w[2]);if(v==0){player_array[v]=new tron.Player("Player"+v,z,t,s,false)}else{player_array[v]=new tron.Player("Player"+v,z,t,s,true)}}function u(F,I,E){var A,G,H;if(I==0){A=G=H=E}else{function D(L,K,J){if(J<0){J+=1}if(J>1){J-=1}if(J<1/6){return L+(K-L)*6*J}if(J<1/2){return K}if(J<2/3){return L+(K-L)*(2/3-J)*6}return L}var B=E<0.5?E*(1+I):E+I-E*I;var C=2*E-B;A=D(C,B,F+1/3);G=D(C,B,F);H=D(C,B,F-1/3)}return[A*255,G*255,H*255]}function h(B){var A=B.toString(16);return A.length==1?"0"+A:A}function x(C,B,A){return"#"+h(Math.round(C))+h(Math.round(B))+h(Math.round(A))}return player_array}function q(s,h,t){b.fillStyle=s;b.fillRect(h*d,t*d,d,d);if(isPixelLook()){b.strokeStyle="#2D2B2C";b.strokeRect(h*d,t*d,d,d)}}function j(){for(var h=0;h<player_array.length;h++){var s=player_array[h];if(s.isAlive()){q(s.pColor,s.positionX,s.positionY)}}}function p(){b.fillStyle="#2D2B2C";b.fillRect(0,0,o,g);b.strokeStyle="#ddd";b.strokeRect(0,0,o,g);for(var s=0;s<player_array.length;s++){var t=player_array[s];if(t.isAlive()){for(var h=0;h<t.area_array.length;h++){q(t.pColor,t.area_array[h].x,t.area_array[h].y)}}}}function r(h){return h.positionX==-1||h.positionX==o/d||h.positionY==-1||h.positionY==g/d}function n(t){var w=player_array.length;for(var s=0;s<w;s++){var x=player_array[s];var v=x.area_array;var u=v.length;for(var h=0;h<u;h++){if(t.positionX==v[h].x&&t.positionY==v[h].y){return true}}}}function m(s){var h=$("textarea#debug");h.val(h.val()+s+"\n");h.scrollTop(h[0].scrollHeight-h.height())}function c(){b.fillStyle="#2D2B2C";b.fillRect(0,0,o,g);b.strokeStyle="#ddd";b.strokeRect(0,0,o,g);this.player_array=f();var h=player_array[0];$(document).keydown(function(t){var s=t.which;if(s=="37"){h.left()}else{if(s=="38"){h.up()}else{if(s=="39"){h.right()}else{if(s=="40"){h.down()}}}}})}this.gameLoop=function(){var h=false;for(var s=0;s<player_array.length;s++){var t=player_array[s];if(t.isAlive){if(t.computer){a(t)}t.move();if(r(t)||n(t)){h=true;t.kill()}}}if(h){p()}j()};function a(h){if(l(h,h.direction)){if(h.direction==tron.Direction.LEFT||h.direction==tron.Direction.RIGHT){if(l(h,tron.Direction.UP)){h.down()}else{if(l(h,tron.Direction.DOWN)){h.up()}else{if(k(1,100)<50){h.up()}else{h.down()}}}}else{if(h.direction==tron.Direction.UP||h.direction==tron.Direction.DOWN){if(l(h,tron.Direction.LEFT)){h.right()}else{if(l(h,tron.Direction.RIGHT)){h.left()}else{if(k(1,100)<50){h.left()}else{h.right()}}}}}}else{if(k(1,100)<5){if(h.direction==tron.Direction.LEFT||h.direction==tron.Direction.RIGHT){if(k(1,100)<50){if(!l(h,tron.Direction.UP)){h.up()}}else{if(!l(h,tron.Direction.DOWN)){h.down()}}}else{if(h.direction==tron.Direction.UP||h.direction==tron.Direction.DOWN){if(k(1,100)<50){if(!l(h,tron.Direction.LEFT)){h.left()}}else{if(!l(h,tron.Direction.RIGHT)){h.right()}}}}}}}function l(s,t){var h=e(s);h.direction=t;h.move();return n(h)||r(h)}function k(s,h){return Math.floor(Math.random()*h)+s}function e(h){clone=new tron.Player(h.pName,h.pColor,h.positionX,h.positionY,h.computer);clone.area_array=h.area_array.slice();clone.direction=h.direction;return clone}};function Interval(c){var d=false;var b=new tron.Game();this.start=function(){if(!this.isRunning()){d=setInterval(a,c)}};this.stop=function(){clearInterval(d);d=false};this.isRunning=function(){return d!==false};this.resetGame=function(){b=new tron.Game()};function a(){b.gameLoop()}}$(document).ready(function(){var e=new Array(33,34,35,36,37,38,39,40);$(document).keydown(function(h){var g=h.which;if($.inArray(g,e)>-1){h.preventDefault();return false}return true});function b(){var i=$("#canvas")[0].getContext("2d");var g=$("#canvas").width();var j=$("#canvas").height();i.fillStyle="#2D2B2C";i.fillRect(0,0,g,j)}function f(){var i=$("#canvas")[0].getContext("2d");var g=$("#canvas").width();var j=$("#canvas").height();i.strokeStyle="#ddd";i.lineWidth=3;i.strokeRect(0,0,g,j)}function d(){var i=document.getElementById("canvas");var j=i.getContext("2d");var g=$("#canvas").width();var k=$("#canvas").height();j.fillStyle="#06f9f9";j.font="16px Arial";j.fillText("Press to Play!",g/2,k/2)}b();f();var c=new Interval($("#speed").val());d();$("#canvas").click(function(){if(!c.isRunning()){a()}});$("#NewGame").click(function(){c.stop();c.resetGame();a()});$("#Pause").click(function(){if(c.isRunning()){c.stop()}else{c.start()}});function a(){if(!c.isRunning()){b();var g=$("#canvas");g.width($("#size").val());g.height($("#size").val());f();c.start()}}});
